"use strict";document.addEventListener("DOMContentLoaded",function(){var a,e=document.getElementById("feedbackFormScreen"),t=["lastName","firstName","phoneNumber","email"],n=document.getElementById("phoneNumber"),n=(n&&(a=IMask(n,{mask:"+{7}(000)000-00-00"})),document.getElementById("email"));function l(){var e;t.forEach(function(e){var t=document.getElementById(e),n=t.nextElementSibling;""!==("phoneNumber"===e?a:t).value.trim()?(t.classList.remove("error"),t.classList.add("valid"),n.style.color="purple"):(t.classList.add("error"),t.classList.remove("valid"),n.style.color="red"),t.addEventListener("focus",function(){""===this.value.trim()&&(n.style.color="red")}),t.addEventListener("blur",function(){""===this.value.trim()&&(n.style.color="transparent")})}),e={lastName:document.getElementById("lastName").value,firstName:document.getElementById("firstName").value,middleName:document.getElementById("middleName").value,phoneNumber:a.value,email:document.getElementById("email").value},localStorage.setItem("feedbackFormData",JSON.stringify(e))}n&&IMask(n,{mask:/^\S*@?\S*$/}),t.forEach(function(e){document.getElementById(e).addEventListener("input",l)}),e.addEventListener("submit",function(e){e.preventDefault();e={lastName:document.getElementById("lastName").value,firstName:document.getElementById("firstName").value,middleName:document.getElementById("middleName").value,phoneNumber:a.value,email:document.getElementById("email").value,loanAmount:document.getElementById("loanAmount").value,initialPayment:document.getElementById("initialPayment").value,interestRate:document.getElementById("interestRate").value,loanTerm:document.getElementById("loanTerm").value,monthlyPayment:document.getElementById("monthlyPaymentResult").innerText};fetch("http://localhost/request",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(function(e){if(e.ok)return e.json();throw new Error("Ошибка сети или сервера")}).then(function(e){e.success?alert("Данные успешно отправлены!"):alert("Произошла ошибка при отправке данных!")}).catch(function(e){console.error("Ошибка:",e),alert("Произошла ошибка при отправке данных!")})}),document.getElementById("toFeedbackFormButton").addEventListener("click",function(){document.getElementById("calculatorScreen").classList.add("hidden"),document.getElementById("feedbackFormScreen").classList.remove("hidden")}),document.getElementById("backToCalculator").addEventListener("click",function(e){e.preventDefault(),document.getElementById("feedbackFormScreen").classList.add("hidden"),document.getElementById("calculatorScreen").classList.remove("hidden")}),(n=JSON.parse(localStorage.getItem("feedbackFormData")))&&(document.getElementById("lastName").value=n.lastName||"",document.getElementById("firstName").value=n.firstName||"",document.getElementById("middleName").value=n.middleName||"",a.value=n.phoneNumber||"",a&&(a.value=n.phoneNumber||"",a.updateValue()),document.getElementById("email").value=n.email||""),l()}),document.addEventListener("DOMContentLoaded",function(){function n(e){return Number.isInteger(e)}function l(e,t){return 0<e&&(!(1<arguments.length&&void 0!==t&&t)||n(e))}function m(e){return 0<e&&e<=5&&n(e)}function a(){var e,t,n,a;["loanAmount","initialPayment","interestRate","loanTerm"].every(function(e){return""!==document.getElementById(e).value.trim()})&&l(parseFloat(document.getElementById("loanAmount").value),!0)&&l(parseFloat(document.getElementById("initialPayment").value),!0)&&l(parseFloat(document.getElementById("interestRate").value)/100)&&m(parseInt(document.getElementById("loanTerm").value))?(e=parseFloat(document.getElementById("loanAmount").value)||0,t=parseFloat(document.getElementById("initialPayment").value)||0,n=(parseFloat(document.getElementById("interestRate").value)||0)/100,a=parseInt(document.getElementById("loanTerm").value)||0,t=!(l(e,!0)&&l(t,!0)&&l(n)&&m(a))||(n=n/12,a=12*a,(e=(e-t)*Math.pow(1+n,a)*n/(Math.pow(1+n,a)-1))<0)?0:e.toFixed(2),document.getElementById("monthlyPaymentResult").innerText="".concat(t," ₽"),document.getElementById("toFeedbackFormButton").removeAttribute("disabled")):document.getElementById("toFeedbackFormButton").setAttribute("disabled","disabled")}var e;document.getElementById("feedbackFormScreen").classList.add("hidden"),(e=JSON.parse(localStorage.getItem("calculatorData")))&&(document.getElementById("loanAmount").value=e.loanAmount||"",document.getElementById("initialPayment").value=e.initialPayment||"",document.getElementById("interestRate").value=e.interestRate||"",document.getElementById("loanTerm").value=e.loanTerm||"",document.getElementById("monthlyPaymentResult").innerText=e.monthlyPaymentResult||""),a(),["loanAmount","initialPayment","interestRate","loanTerm"].forEach(function(e){var e=document.getElementById(e),t=e.nextElementSibling;l(parseFloat(e.value))?t.style.color="purple":""===e.value.trim()?t.style.color="transparent":t.style.color="red"});["loanAmount","initialPayment","interestRate","loanTerm"].forEach(function(e){var e=document.getElementById(e),t=e.nextElementSibling;e.addEventListener("focus",function(){""===this.value.trim()&&(t.style.color="red")}),e.addEventListener("blur",function(){""===this.value.trim()&&(t.style.color="transparent")}),e.addEventListener("input",function(){var e;l(parseFloat(this.value))?(this.classList.remove("error"),this.classList.add("valid"),t.style.color="purple"):(this.classList.remove("valid"),this.classList.add("error"),t.style.color="red"),e={loanAmount:document.getElementById("loanAmount").value,initialPayment:document.getElementById("initialPayment").value,interestRate:document.getElementById("interestRate").value,loanTerm:document.getElementById("loanTerm").value,monthlyPaymentResult:document.getElementById("monthlyPaymentResult").innerText},localStorage.setItem("calculatorData",JSON.stringify(e)),a()})}),document.getElementById("toFeedbackFormButton").addEventListener("click",function(){document.getElementById("calculatorScreen").classList.add("hidden"),document.getElementById("feedbackFormScreen").classList.remove("hidden")}),document.getElementById("backToCalculator").addEventListener("click",function(){document.getElementById("feedbackFormScreen").classList.add("hidden"),document.getElementById("calculatorScreen").classList.remove("hidden")})});