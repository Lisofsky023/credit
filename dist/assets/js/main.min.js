"use strict";var isIntegerValue=function(e){return Number.isInteger(e)},isValidValue=function(e){return 0<e&&(!(1<arguments.length&&void 0!==arguments[1]&&arguments[1])||isIntegerValue(e))},isValidLoanTerm=function(e){return 0<e&&e<=5&&isIntegerValue(e)};function calculateMonthlyPayment(){var e=document.getElementById("loanAmount"),t=document.getElementById("initialPayment"),a=document.getElementById("interestRate"),n=document.getElementById("loanTerm"),e=parseFloat(e.value)||0,t=parseFloat(t.value)||0,a=(parseFloat(a.value)||0)/100,n=parseInt(n.value)||0;return!(isValidValue(e,!0)&&isValidValue(t,!0)&&isValidValue(a)&&isValidLoanTerm(n))||(a=a/12,n=12*n,(e=(e-t)*Math.pow(1+a,n)*a/(Math.pow(1+a,n)-1))<0)?0:e.toFixed(2)}function saveToLocalStorage(){var e={loanAmount:document.getElementById("loanAmount").value,initialPayment:document.getElementById("initialPayment").value,interestRate:document.getElementById("interestRate").value,loanTerm:document.getElementById("loanTerm").value,monthlyPaymentResult:document.getElementById("monthlyPaymentResult").innerText};localStorage.setItem("calculatorData",JSON.stringify(e))}function loadFromLocalStorage(){var e=document.getElementById("loanAmount"),t=document.getElementById("initialPayment"),a=document.getElementById("interestRate"),n=document.getElementById("loanTerm"),l=document.getElementById("monthlyPaymentResult"),o=JSON.parse(localStorage.getItem("calculatorData"));o&&(e.value=o.loanAmount||"",t.value=o.initialPayment||"",a.value=o.interestRate||"",n.value=o.loanTerm||"",l.innerText=o.monthlyPaymentResult||"")}function updateLabelColors(){["loanAmount","initialPayment","interestRate","loanTerm"].forEach(function(e){var e=document.getElementById(e),t=e.nextElementSibling;isValidValue(parseFloat(e.value))?t.style.color="purple":""===e.value.trim()?t.style.color="transparent":t.style.color="red"})}function checkFieldsAndSetButtonState(){var e=document.getElementById("loanAmount"),t=document.getElementById("initialPayment"),a=document.getElementById("interestRate"),n=document.getElementById("loanTerm"),l=document.getElementById("monthlyPaymentResult"),o=document.getElementById("toFeedbackFormButton");""!==e.value.trim()&&isValidValue(parseFloat(e.value),!0)&&isValidValue(parseFloat(t.value),!0)&&isValidValue(parseFloat(a.value)/100)&&isValidLoanTerm(parseInt(n.value))?(e=calculateMonthlyPayment(),l.innerText="".concat(e," ₽"),o.removeAttribute("disabled")):o.setAttribute("disabled","disabled")}function setupPhoneNumberMask(){var t,a,n=document.getElementById("phoneNumber");return n&&(t=IMask(n,{mask:"+{7}(000)000-00-00"}),a=n.nextElementSibling,n.addEventListener("input",function(){var e=t.unmaskedValue;!e||11!==e.length||t.value.includes("_")?(n.classList.add("error"),n.classList.remove("valid"),a.style.color="red"):(n.classList.remove("error"),n.classList.add("valid"),a.style.color="purple")})),t}function setupEmailMask(){var e,t=document.getElementById("email");return t&&(e=IMask(t,{mask:/^\S*@?\S*$/})),e}function saveFeedbackFormToLocalStorage(e){var t=document.getElementById("lastName"),a=document.getElementById("firstName"),n=document.getElementById("middleName"),l=document.getElementById("email"),t={lastName:t.value,firstName:a.value,middleName:n.value,phoneNumber:e?e.value:"",email:l.value};localStorage.setItem("feedbackFormData",JSON.stringify(t))}function loadFeedbackFormFromLocalStorage(e,t){var a=document.getElementById("lastName"),n=document.getElementById("firstName"),l=document.getElementById("middleName"),o=document.getElementById("email"),d=JSON.parse(localStorage.getItem("feedbackFormData"));d&&(a.value=d.lastName||"",n.value=d.firstName||"",l.value=d.middleName||"",e&&e.updateValue&&(e.value=d.phoneNumber||"",e.updateValue()),t)&&t.updateValue&&(o.value=d.email||"",t.updateValue())}function validateFormFields(e,t){var l={lastName:3,firstName:3,middleName:3};["lastName","firstName","middleName","email"].forEach(function(t){function e(){var e=a.value;if("email"===t)if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))return a.classList.add("error"),a.classList.remove("valid"),void(n.style.color="red");e&&""!==e.trim()&&(!l[t]||e.length>=l[t])?(a.classList.remove("error"),a.classList.add("valid"),n.style.color="purple"):(a.classList.add("error"),a.classList.remove("valid"),n.style.color="red")}var a=document.getElementById(t),n=a.nextElementSibling;n.style.color="transparent";a.addEventListener("focus",function(){n.style.color="red",e()}),a.addEventListener("blur",function(){""===a.value.trim()&&(n.style.color="transparent")}),a.addEventListener("input",e)}),saveFeedbackFormToLocalStorage()}function submitFeedbackForm(e,t){e={lastName:document.getElementById("lastName").value,firstName:document.getElementById("firstName").value,middleName:document.getElementById("middleName").value,phoneNumber:e.value,email:document.getElementById("email").value,loanAmount:document.getElementById("loanAmount").value,initialPayment:document.getElementById("initialPayment").value,interestRate:document.getElementById("interestRate").value,loanTerm:document.getElementById("loanTerm").value,monthlyPayment:document.getElementById("monthlyPaymentResult").innerText};fetch("http://localhost/request",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(function(e){if(e.ok)return e.json();throw new Error("Ошибка сети или сервера")}).then(function(e){e.success?alert("Данные успешно отправлены!"):alert("Произошла ошибка при отправке данных!")}).catch(function(e){console.error("Ошибка:",e),alert("Произошла ошибка при отправке данных!")})}document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("calculatorScreen"),t=document.getElementById("feedbackFormScreen"),a=document.getElementById("toFeedbackFormButton"),n=document.getElementById("backToCalculator");t.classList.add("hidden"),loadFromLocalStorage(),checkFieldsAndSetButtonState(),updateLabelColors(),["loanAmount","initialPayment","interestRate","loanTerm","middleName"].forEach(function(e){var t=document.getElementById(e),a=t.nextElementSibling;t.addEventListener("focus",function(){""===t.value.trim()&&(a.style.color="red")}),t.addEventListener("blur",function(){""===t.value.trim()&&(a.style.color="transparent")}),t.addEventListener("input",function(){isValidValue(parseFloat(t.value))?(t.classList.remove("error"),t.classList.add("valid"),a.style.color="purple"):(t.classList.remove("valid"),t.classList.add("error"),a.style.color="red"),saveToLocalStorage(),checkFieldsAndSetButtonState()})}),a.addEventListener("click",function(){e.classList.add("hidden"),t.classList.remove("hidden")}),n.addEventListener("click",function(){t.classList.add("hidden"),e.classList.remove("hidden")})});var phoneMask=setupPhoneNumberMask(),emailMask=setupEmailMask(),feedbackFormScreen=document.getElementById("feedbackFormScreen"),calculatorScreen=document.getElementById("calculatorScreen"),toFeedbackFormButton=document.getElementById("toFeedbackFormButton"),backToCalculator=document.getElementById("backToCalculator"),formFieldsElements=["lastName","firstName","phoneNumber","email"].map(function(e){return document.getElementById(e)});document.addEventListener("DOMContentLoaded",function(){formFieldsElements.forEach(function(e){e.addEventListener("input",validateFormFields)}),feedbackFormScreen.addEventListener("submit",function(e){e.preventDefault(),submitFeedbackForm(phoneMask,emailMask)}),toFeedbackFormButton.addEventListener("click",function(){calculatorScreen.classList.add("hidden"),feedbackFormScreen.classList.remove("hidden")}),backToCalculator.addEventListener("click",function(e){e.preventDefault(),feedbackFormScreen.classList.add("hidden"),calculatorScreen.classList.remove("hidden")}),loadFeedbackFormFromLocalStorage(phoneMask,emailMask),validateFormFields(phoneMask,emailMask)});